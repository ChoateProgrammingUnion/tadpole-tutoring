<!DOCTYPE html>
<html lang="en">
<head>
    {{ header }}
    <!--<script>-->
        <!--$( document ).ready(function() {-->
            <!--$( "#switch-tutor" ).click();-->
        <!--});-->
    <!--</script>-->
    <script type="text/javascript" src="brython/brython.js"></script>
    <script async type="text/javascript" src="brython/brython_stdlib.js"></script>
    <!--<script async type="text/javascript" src="brython/brython.js"></script>-->
    <!--<script async type="text/javascript" src="brython/brython_stdlib.js"></script>-->
</head>
<body onload="brython()">
    <script type="text/python">
        from browser import document, alert
        import browser
        from browser.template import Template
        import urllib.request
        import pickle
        import base64
        import collections


        def echo(ev):
            value = document['switch-tutor-value'].text
            value = not bool(value)

            if value:
                document['results'].html = ""
                document['switch-tutor-value'].text = "True"
                search_by_tutor()
            else:
                document['results'].html = ""
                document['switch-tutor-value'].text = ""

        def fetch_template(url):
            """
            Fetches and renders template
            """
            response = urllib.request.urlopen(url).read().rstrip()
            return response

        def fetch_template_tutor_bio(vars):
            """
            Fetches and renders template
            """
            # URL = str(browser.window.location.href).replace(str(browser.window.location.pathname), "/")
            response = urllib.request.urlopen("/teacher_bio.html").read().rstrip()
            html = ""
            for each_var in vars:
                each_dict = {x_var: y_var for _, (x_var, y_var) in each_var.items()}
                # each_dict = dict(collections.OrderedDict(each_var))
                # html += Template(response).render(**each_dict)
                print(response, each_dict)
                html += response.format(**each_dict)

            return html

        def search_by_tutor():
            """
            calls api
            """
            tutor_html = fetch_template("tutor_template.html")
            document['results'].html = tutor_html

            # URL = "api.tadpoletutoring.org"
            URL = "http://localhost:5000"
            response = urllib.request.urlopen(URL + "/api/teachers").read().rstrip()
            response_decode = base64.b64decode(response.encode())
            response_dict = pickle.loads(response_decode)
            tutor_bio_html = fetch_template_tutor_bio(response_dict)
            print("Tutor HTML", tutor_bio_html)

            # set and save
            document['schedule-results'].html = tutor_bio_html

        def search_by_time(): 
            """
            searches by time
            """
            pass


        document["switch-tutor"].bind("mouseup", echo)
        jq = browser.window.jQuery
        jq("#clicky-slider").click()
    </script>
    <header style="padding-top: 0; padding-bottom: 0;">
    {{ navbar }}
    </header>
    <main>
        <div style="margin-left:80%" id="clicky-slider">
            <div style="display: inline-block">
            <span style="white-space: nowrap;">By Time</span>
            <label id="switch-tutor" class="switch">
                <input type="checkbox">
                <span class="slider round"></span> 
            </label> 
            <span style="white-space: nowrap;">By Tutor</span>
            <span id="switch-tutor-value" style="visibility:hidden"></span>
            </div>
        </div>
        <div id="results">
        </div>
    </main>
{{ footer }}
</body>

</html>
