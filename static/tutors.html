<!DOCTYPE html>
<html lang="en">
<head>
    {{ header }}
    <script>
        $( document ).ready(function() {
            $( "#switch-tutor" ).click();
        });
    </script>
</head>
<body onload="brython()">
    <script type="text/python">
        from browser import document, alert
        import browser
        from browser.template import Template
        # from browser import document, alert, Template
        import urllib.request
        import pickle
        import base64
        import collections

        def echo(ev):
            value = document['switch-tutor-value'].text
            value = not bool(value)

            if value:
                document['switch-tutor-value'].text = "True"
                search_by_tutor()
            else:
                document['switch-tutor-value'].text = ""

        def fetch_template(vars):
            # URL = str(browser.window.location.href).replace(str(browser.window.location.pathname), "/")
            response = urllib.request.urlopen("/teacher_bio.html").read().rstrip()
            html = ""
            for each_var in vars:
                each_dict = {x_var: y_var for _, (x_var, y_var) in each_var.items()}
                # each_dict = dict(collections.OrderedDict(each_var))
                # html += Template(response).render(**each_dict)
                print(response, each_dict)
                html += response.format(**each_dict)

            return html

        def search_by_tutor():
            # URL = "api.tadpoletutoring.org"
            URL = "http://localhost:5000"
            response = urllib.request.urlopen(URL + "/api/teachers").read().rstrip()
            response_decode = base64.b64decode(response.encode())
            response_dict = pickle.loads(response_decode)
            html = fetch_template(response_dict)
            print("HTML", html)
            document['schedule-results'].html = html

        document["clicky-slider"].bind("mouseup", echo)
        echo("None")
    </script>
    <header style="padding-top: 0; padding-bottom: 0;">
    {{ navbar }}
    </header>
    <main>
        <div style="margin-left:80%" id="clicky-slider">
            <div style="display: inline-block">
            <span style="white-space: nowrap;">By Time</span>
            <label id="switch-tutor" class="switch">
                <input type="checkbox">
                <span class="slider round"></span> 
            </label> 
            <span style="white-space: nowrap;">By Tutor</span>
            <span id="switch-tutor-value" style="visibility:hidden">True</span>
            </div>
        </div>
        <section>
            <header>
                <h2>Our Tutors</h2>
                <p>Our team of tutors is small and tight-knit. Each tutor here is hand-picked to help ensure that you can learn well.</p>
            </header>
            <span id="schedule-results"></span>
        </section>
    </main>
{{ footer }}
</body>

</html>
