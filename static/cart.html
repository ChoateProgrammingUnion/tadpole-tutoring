<!DOCTYPE html>
<html lang="en">
<head>
    {{ header }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brython/3.8.8/brython.min.js"
            integrity="sha256-o/getzwHeAq4xcWJ350CFg+70KNoYxxdK8ikIp76hIM=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="brython/brython_modules.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="/checkout.js"></script>
    <script>
        function setupPayment() {
            tempData = {};
            Object.assign(tempData, orderData);

            cookie_list = document.cookie.split('; ');

            for (var i = 0; i < cookie_list.length; i++) {
                cookie_tuple = cookie_list[i].split('=');
                tempData[cookie_tuple[0]] = cookie_tuple[1].replace('"', '').replace('"', '')
            }

            fetch(url + "/api/create-payment-intent", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(tempData)
            })
                .then(function (result) {
                    return result.json();
                })
                .then(function (data) {
                    return setupElements(data);
                })
                .then(function ({stripe, card, clientSecret, intentId}) {
                    document.querySelector("button").disabled = false;

                    // Handle form submission.
                    var form = document.getElementById("payment-form");
                    form.addEventListener("submit", function (event) {
                        event.preventDefault();
                        // Initiate payment when the submit button is clicked
                        pay(stripe, card, clientSecret, intentId);
                    });
                });
        }
    </script>
</head>
<body onload="brython()">
<script type="text/python" src="cart.py"></script>

<header style="padding-top: 0; padding-bottom: 0;">
    {{ navbar }}
</header>
<div style="text-align: center;">
    <p><u>Cart</u></p>
    <table id="cart-table">
        <tr><th>Loading Cart...</th></tr>
    </table>
    <br><br>
    <p><u id='checkout-label'></u></p>
    <table id="checkout-table">
    </table>
    <br><br>
    <section id="payment-area">
    </section>
</div>
</body>
</html>